{"id":"UuLR","dependencies":[{"name":"/Users/guoyaqi/work/2020/playground/node_modules/monaco-editor/package.json","includedInParent":true,"mtime":1584771267802},{"name":"./diffChange.js","loc":{"line":5,"column":27},"parent":"/Users/guoyaqi/work/2020/playground/node_modules/monaco-editor/esm/vs/base/common/diff/diff.js","resolved":"/Users/guoyaqi/work/2020/playground/node_modules/monaco-editor/esm/vs/base/common/diff/diffChange.js"},{"name":"../hash.js","loc":{"line":6,"column":27},"parent":"/Users/guoyaqi/work/2020/playground/node_modules/monaco-editor/esm/vs/base/common/diff/diff.js","resolved":"/Users/guoyaqi/work/2020/playground/node_modules/monaco-editor/esm/vs/base/common/hash.js"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.stringDiff=n,exports.LcsDiff=exports.MyArray=exports.Debug=exports.StringDiffSequence=void 0;var t=require(\"./diffChange.js\"),i=require(\"../hash.js\"),e=function(){function t(t){this.source=t}return t.prototype.getElements=function(){for(var t=this.source,i=new Int32Array(t.length),e=0,n=t.length;e<n;e++)i[e]=t.charCodeAt(e);return i},t}();function n(t,i,n){return new s(new e(t),new e(i)).ComputeDiff(n).changes}exports.StringDiffSequence=e;var r=function(){function t(){}return t.Assert=function(t,i){if(!t)throw new Error(i)},t}();exports.Debug=r;var o=function(){function t(){}return t.Copy=function(t,i,e,n,r){for(var o=0;o<r;o++)e[n+o]=t[i+o]},t.Copy2=function(t,i,e,n,r){for(var o=0;o<r;o++)e[n+o]=t[i+o]},t}();exports.MyArray=o;var a=function(){function i(){this.m_changes=[],this.m_originalStart=1073741824,this.m_modifiedStart=1073741824,this.m_originalCount=0,this.m_modifiedCount=0}return i.prototype.MarkNextChange=function(){(this.m_originalCount>0||this.m_modifiedCount>0)&&this.m_changes.push(new t.DiffChange(this.m_originalStart,this.m_originalCount,this.m_modifiedStart,this.m_modifiedCount)),this.m_originalCount=0,this.m_modifiedCount=0,this.m_originalStart=1073741824,this.m_modifiedStart=1073741824},i.prototype.AddOriginalElement=function(t,i){this.m_originalStart=Math.min(this.m_originalStart,t),this.m_modifiedStart=Math.min(this.m_modifiedStart,i),this.m_originalCount++},i.prototype.AddModifiedElement=function(t,i){this.m_originalStart=Math.min(this.m_originalStart,t),this.m_modifiedStart=Math.min(this.m_modifiedStart,i),this.m_modifiedCount++},i.prototype.getChanges=function(){return(this.m_originalCount>0||this.m_modifiedCount>0)&&this.MarkNextChange(),this.m_changes},i.prototype.getReverseChanges=function(){return(this.m_originalCount>0||this.m_modifiedCount>0)&&this.MarkNextChange(),this.m_changes.reverse(),this.m_changes},i}(),s=function(){function e(t,i,n){void 0===n&&(n=null),this.ContinueProcessingPredicate=n;var r=e._getElements(t),o=r[0],a=r[1],s=r[2],h=e._getElements(i),g=h[0],l=h[1],d=h[2];this._hasStrings=s&&d,this._originalStringElements=o,this._originalElementsOrHash=a,this._modifiedStringElements=g,this._modifiedElementsOrHash=l,this.m_forwardHistory=[],this.m_reverseHistory=[]}return e._isStringArray=function(t){return t.length>0&&\"string\"==typeof t[0]},e._getElements=function(t){var n=t.getElements();if(e._isStringArray(n)){for(var r=new Int32Array(n.length),o=0,a=n.length;o<a;o++)r[o]=(0,i.stringHash)(n[o],0);return[n,r,!0]}return n instanceof Int32Array?[[],n,!1]:[[],new Int32Array(n),!1]},e.prototype.ElementsAreEqual=function(t,i){return this._originalElementsOrHash[t]===this._modifiedElementsOrHash[i]&&(!this._hasStrings||this._originalStringElements[t]===this._modifiedStringElements[i])},e.prototype.OriginalElementsAreEqual=function(t,i){return this._originalElementsOrHash[t]===this._originalElementsOrHash[i]&&(!this._hasStrings||this._originalStringElements[t]===this._originalStringElements[i])},e.prototype.ModifiedElementsAreEqual=function(t,i){return this._modifiedElementsOrHash[t]===this._modifiedElementsOrHash[i]&&(!this._hasStrings||this._modifiedStringElements[t]===this._modifiedStringElements[i])},e.prototype.ComputeDiff=function(t){return this._ComputeDiff(0,this._originalElementsOrHash.length-1,0,this._modifiedElementsOrHash.length-1,t)},e.prototype._ComputeDiff=function(t,i,e,n,r){var o=[!1],a=this.ComputeDiffRecursive(t,i,e,n,o);return r&&(a=this.PrettifyChanges(a)),{quitEarly:o[0],changes:a}},e.prototype.ComputeDiffRecursive=function(i,e,n,o,a){for(a[0]=!1;i<=e&&n<=o&&this.ElementsAreEqual(i,n);)i++,n++;for(;e>=i&&o>=n&&this.ElementsAreEqual(e,o);)e--,o--;if(i>e||n>o){var s=void 0;return n<=o?(r.Assert(i===e+1,\"originalStart should only be one more than originalEnd\"),s=[new t.DiffChange(i,0,n,o-n+1)]):i<=e?(r.Assert(n===o+1,\"modifiedStart should only be one more than modifiedEnd\"),s=[new t.DiffChange(i,e-i+1,n,0)]):(r.Assert(i===e+1,\"originalStart should only be one more than originalEnd\"),r.Assert(n===o+1,\"modifiedStart should only be one more than modifiedEnd\"),s=[]),s}var h=[0],g=[0],l=this.ComputeRecursionPoint(i,e,n,o,h,g,a),d=h[0],f=g[0];if(null!==l)return l;if(!a[0]){var u=this.ComputeDiffRecursive(i,d,n,f,a),m=[];return m=a[0]?[new t.DiffChange(d+1,e-(d+1)+1,f+1,o-(f+1)+1)]:this.ComputeDiffRecursive(d+1,e,f+1,o,a),this.ConcatenateChanges(u,m)}return[new t.DiffChange(i,e-i+1,n,o-n+1)]},e.prototype.WALKTRACE=function(i,e,n,r,o,s,h,g,l,d,f,u,m,_,p,y,c,S){var C,E=null,v=new a,A=e,L=n,M=m[0]-y[0]-r,O=-1073741824,w=this.m_forwardHistory.length-1;do{(x=M+i)===A||x<L&&l[x-1]<l[x+1]?(_=(f=l[x+1])-M-r,f<O&&v.MarkNextChange(),O=f,v.AddModifiedElement(f+1,_),M=x+1-i):(_=(f=l[x-1]+1)-M-r,f<O&&v.MarkNextChange(),O=f-1,v.AddOriginalElement(f,_+1),M=x-1-i),w>=0&&(i=(l=this.m_forwardHistory[w])[0],A=1,L=l.length-1)}while(--w>=-1);if(C=v.getReverseChanges(),S[0]){var D=m[0]+1,H=y[0]+1;if(null!==C&&C.length>0){var I=C[C.length-1];D=Math.max(D,I.getOriginalEnd()),H=Math.max(H,I.getModifiedEnd())}E=[new t.DiffChange(D,u-D+1,H,p-H+1)]}else{v=new a,A=s,L=h,M=m[0]-y[0]-g,O=1073741824,w=c?this.m_reverseHistory.length-1:this.m_reverseHistory.length-2;do{var x;(x=M+o)===A||x<L&&d[x-1]>=d[x+1]?(_=(f=d[x+1]-1)-M-g,f>O&&v.MarkNextChange(),O=f+1,v.AddOriginalElement(f+1,_+1),M=x+1-o):(_=(f=d[x-1])-M-g,f>O&&v.MarkNextChange(),O=f,v.AddModifiedElement(f+1,_+1),M=x-1-o),w>=0&&(o=(d=this.m_reverseHistory[w])[0],A=1,L=d.length-1)}while(--w>=-1);E=v.getChanges()}return this.ConcatenateChanges(C,E)},e.prototype.ComputeRecursionPoint=function(i,e,n,r,a,s,h){var g=0,l=0,d=0,f=0,u=0,m=0;i--,n--,a[0]=0,s[0]=0,this.m_forwardHistory=[],this.m_reverseHistory=[];var _=e-i+(r-n),p=_+1,y=new Int32Array(p),c=new Int32Array(p),S=r-n,C=e-i,E=i-n,v=e-r,A=(C-S)%2==0;y[S]=i,c[C]=e,h[0]=!1;for(var L=1;L<=_/2+1;L++){var M=0,O=0;d=this.ClipDiagonalBound(S-L,L,S,p),f=this.ClipDiagonalBound(S+L,L,S,p);for(var w=d;w<=f;w+=2){l=(g=w===d||w<f&&y[w-1]<y[w+1]?y[w+1]:y[w-1]+1)-(w-S)-E;for(var D=g;g<e&&l<r&&this.ElementsAreEqual(g+1,l+1);)g++,l++;if(y[w]=g,g+l>M+O&&(M=g,O=l),!A&&Math.abs(w-C)<=L-1&&g>=c[w])return a[0]=g,s[0]=l,D<=c[w]&&L<=1448?this.WALKTRACE(S,d,f,E,C,u,m,v,y,c,g,e,a,l,r,s,A,h):null}var H=(M-i+(O-n)-L)/2;if(null!==this.ContinueProcessingPredicate&&!this.ContinueProcessingPredicate(M,H))return h[0]=!0,a[0]=M,s[0]=O,H>0&&L<=1448?this.WALKTRACE(S,d,f,E,C,u,m,v,y,c,g,e,a,l,r,s,A,h):(i++,n++,[new t.DiffChange(i,e-i+1,n,r-n+1)]);u=this.ClipDiagonalBound(C-L,L,C,p),m=this.ClipDiagonalBound(C+L,L,C,p);for(w=u;w<=m;w+=2){l=(g=w===u||w<m&&c[w-1]>=c[w+1]?c[w+1]-1:c[w-1])-(w-C)-v;for(D=g;g>i&&l>n&&this.ElementsAreEqual(g,l);)g--,l--;if(c[w]=g,A&&Math.abs(w-S)<=L&&g<=y[w])return a[0]=g,s[0]=l,D>=y[w]&&L<=1448?this.WALKTRACE(S,d,f,E,C,u,m,v,y,c,g,e,a,l,r,s,A,h):null}if(L<=1447){var I=new Int32Array(f-d+2);I[0]=S-d+1,o.Copy2(y,d,I,1,f-d+1),this.m_forwardHistory.push(I),(I=new Int32Array(m-u+2))[0]=C-u+1,o.Copy2(c,u,I,1,m-u+1),this.m_reverseHistory.push(I)}}return this.WALKTRACE(S,d,f,E,C,u,m,v,y,c,g,e,a,l,r,s,A,h)},e.prototype.PrettifyChanges=function(t){for(var i=0;i<t.length;i++){for(var e=t[i],n=i<t.length-1?t[i+1].originalStart:this._originalElementsOrHash.length,r=i<t.length-1?t[i+1].modifiedStart:this._modifiedElementsOrHash.length,o=e.originalLength>0,a=e.modifiedLength>0;e.originalStart+e.originalLength<n&&e.modifiedStart+e.modifiedLength<r&&(!o||this.OriginalElementsAreEqual(e.originalStart,e.originalStart+e.originalLength))&&(!a||this.ModifiedElementsAreEqual(e.modifiedStart,e.modifiedStart+e.modifiedLength));)e.originalStart++,e.modifiedStart++;var s=[null];i<t.length-1&&this.ChangesOverlap(t[i],t[i+1],s)&&(t[i]=s[0],t.splice(i+1,1),i--)}for(i=t.length-1;i>=0;i--){e=t[i],n=0,r=0;if(i>0){var h=t[i-1];h.originalLength>0&&(n=h.originalStart+h.originalLength),h.modifiedLength>0&&(r=h.modifiedStart+h.modifiedLength)}o=e.originalLength>0,a=e.modifiedLength>0;for(var g=0,l=this._boundaryScore(e.originalStart,e.originalLength,e.modifiedStart,e.modifiedLength),d=1;;d++){var f=e.originalStart-d,u=e.modifiedStart-d;if(f<n||u<r)break;if(o&&!this.OriginalElementsAreEqual(f,f+e.originalLength))break;if(a&&!this.ModifiedElementsAreEqual(u,u+e.modifiedLength))break;var m=this._boundaryScore(f,e.originalLength,u,e.modifiedLength);m>l&&(l=m,g=d)}e.originalStart-=g,e.modifiedStart-=g}return t},e.prototype._OriginalIsBoundary=function(t){return t<=0||t>=this._originalElementsOrHash.length-1||this._hasStrings&&/^\\s*$/.test(this._originalStringElements[t])},e.prototype._OriginalRegionIsBoundary=function(t,i){if(this._OriginalIsBoundary(t)||this._OriginalIsBoundary(t-1))return!0;if(i>0){var e=t+i;if(this._OriginalIsBoundary(e-1)||this._OriginalIsBoundary(e))return!0}return!1},e.prototype._ModifiedIsBoundary=function(t){return t<=0||t>=this._modifiedElementsOrHash.length-1||this._hasStrings&&/^\\s*$/.test(this._modifiedStringElements[t])},e.prototype._ModifiedRegionIsBoundary=function(t,i){if(this._ModifiedIsBoundary(t)||this._ModifiedIsBoundary(t-1))return!0;if(i>0){var e=t+i;if(this._ModifiedIsBoundary(e-1)||this._ModifiedIsBoundary(e))return!0}return!1},e.prototype._boundaryScore=function(t,i,e,n){return(this._OriginalRegionIsBoundary(t,i)?1:0)+(this._ModifiedRegionIsBoundary(e,n)?1:0)},e.prototype.ConcatenateChanges=function(t,i){var e=[];if(0===t.length||0===i.length)return i.length>0?i:t;if(this.ChangesOverlap(t[t.length-1],i[0],e)){var n=new Array(t.length+i.length-1);return o.Copy(t,0,n,0,t.length-1),n[t.length-1]=e[0],o.Copy(i,1,n,t.length,i.length-1),n}n=new Array(t.length+i.length);return o.Copy(t,0,n,0,t.length),o.Copy(i,0,n,t.length,i.length),n},e.prototype.ChangesOverlap=function(i,e,n){if(r.Assert(i.originalStart<=e.originalStart,\"Left change is not less than or equal to right change\"),r.Assert(i.modifiedStart<=e.modifiedStart,\"Left change is not less than or equal to right change\"),i.originalStart+i.originalLength>=e.originalStart||i.modifiedStart+i.modifiedLength>=e.modifiedStart){var o=i.originalStart,a=i.originalLength,s=i.modifiedStart,h=i.modifiedLength;return i.originalStart+i.originalLength>=e.originalStart&&(a=e.originalStart+e.originalLength-i.originalStart),i.modifiedStart+i.modifiedLength>=e.modifiedStart&&(h=e.modifiedStart+e.modifiedLength-i.modifiedStart),n[0]=new t.DiffChange(o,a,s,h),!0}return n[0]=null,!1},e.prototype.ClipDiagonalBound=function(t,i,e,n){if(t>=0&&t<n)return t;var r=i%2==0;return t<0?r===(e%2==0)?0:1:r===((n-e-1)%2==0)?n-1:n-2},e}();exports.LcsDiff=s;"},"sourceMaps":null,"error":null,"hash":"6311fe27948fefb35f28453387fd08ec","cacheData":{"env":{}}}